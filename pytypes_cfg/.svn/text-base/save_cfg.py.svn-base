#!/usr/bin/env python
# -*- coding: utf-8 -*-

import sys

from cfg_creator import CFGCreator
#from pytypes_cfg.cfg_creator import CFGCreator

class SaveCFG(object):
    #def __init__(self):
        #pass
    @staticmethod
    def save_to(module, path, format, all_instructions):
        print 'Saving images(of %i): ' % len(module.cfg),
        i = 1
        for name, graph in module.dot_repr(all_instructions):
            graph.write(path+"/"+name+'.'+format, None, format)
            sys.stdout.write('%i.' % i)
            sys.stdout.flush()
            #print '%i.' % i,
            i += 1
        print '.. Done.'
        
if __name__ == '__main__':

    from optparse import OptionParser
    parser = OptionParser()
    parser.set_usage("%s [-f <format>] [-o <output_dir>] filename" % (sys.argv[0]))
    #parser.add_option("-c", "--comments", action='store_true', type='string', dest='confFileName', default = True)
    parser.add_option("-f", "--format", action='store', type='string', dest='format', default = 'png', help='one of png, jpg, jpeg, ps, pdf, etc.')
    parser.add_option("-o", "--out_directory", action='store', type='string', dest='dirName', default = './pics/')
    parser.add_option("-a", "--all_instructions", action='store_true', dest='all_instructions', default = False)
    options, args = parser.parse_args()

    
    if(len(args) != 1):
        parser.print_usage()
        print "Try `%s -h` for more information." % sys.argv[0]
        sys.exit(0)
    #print sys.argv[1], sys.argv[2]
    SaveCFG.save_to(CFGCreator.make_cfgs(args[0]), options.dirName, options.format, options.all_instructions)
    #c1.make_cfgs()
    #c1.saveTo(sys.argv[2], c1.uniteSomeBlocks(c1.removeExitEdges(c1.removeUnreachebleBlocks(c1.returnCFG()[0]))), len(sys.argv) >= 4 and sys.argv[3].lower() == "true")
